import{m as r,B as X,D as Z,I as G,v as H,o as W,g as ee,M as te}from"./ant-design-vue-69c5e787.js";import{_ as ae,a as $}from"./index-a7c45ba7.js";import{c as ne}from"./lodash-es-c37e40cf.js";import{l as v,e as oe,r as de,X as s,Y as k,Z as f,E as S,a7 as P,c as D,a0 as m,F as le,a6 as ie,a1 as A,a2 as se,a3 as ce}from"./@vue-0057e33b.js";function ue(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var T=Math.random()*16|0,g=u==="x"?T:T&3|8;return g.toString()})}const _e=u=>(se("data-v-778bcaa6"),u=u(),ce(),u),pe={key:0},re={key:1,class:"editable-row-operations"},ve={key:0},fe={key:1},xe=["onClick"],me=_e(()=>A("a",null,"删除",-1)),ge={__name:"ContactDetailTable",props:{formType:{type:String,default:"grkh"},isReadOnly:{type:Boolean,default:!1}},emits:["cancel","ok"],setup(u,{expose:T,emit:g}){const O=u,h=v(!1),b=v(""),E=e=>{b.value=e,h.value=!0,R()},F=()=>{b.value="",h.value=!1},I=oe("$http"),p="YYYY-MM-DD",C=[{title:O.formType==="jgkh"?"拜访日期":"联系日期",dataIndex:"contact_date"},{title:O.formType==="jgkh"?"拜访情况说明":"联系情况说明",dataIndex:"contact_detail"},{title:"需求",dataIndex:"demand"},{title:O.formType==="jgkh"?"预约下次拜访时间":"预约下次联系时间",dataIndex:"next_contact_date"},{title:"提醒时长",dataIndex:"remind_duration"},{title:"操作",dataIndex:"operation"}];O.isReadOnly&&C.splice(C.length-1,1);const c=v([]),z=v(!1),a=de({}),x=v([]),l=v({current:1,pageSize:10,total:0,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共${e}条`}),M=e=>{l.value.current=e.current,l.value.pageSize=e.pageSize,l.value.total=e.total,R()},L=()=>{const e={id:ue(),customer_id:b.value,contact_date:"",contact_detail:"",demand:"",next_contact_date:"",remind_duration:""};c.value.unshift(e),x.value.push(e.id),w(e.id),l.value.current=1},R=()=>{z.value=!0;const e={customerId:b.value,pageNo:l.value.current,pageSize:l.value.pageSize};I.get($.contacts,{params:e}).then(t=>{const{data:n,total:i}=t;c.value=n,l.value.total=i}).finally(()=>{z.value=!1})},w=e=>{a[e]=ne(c.value.filter(t=>e===t.id)[0])},U=e=>{x.value.includes(e)?B(e):N(e)},B=e=>{const t=r.loading("正在提交",0);I.post($.contacts,{...a[e]}).then(n=>{n.code===0&&(r.success("新增成功"),a[e].id=n.data.contact_id,x.value=x.value.filter(i=>i.id!==e))}).finally(()=>{Object.assign(c.value.filter(n=>e===n.id)[0],a[e]),y(e),t()})},N=e=>{const t=r.loading("正在提交",0);I.put(`${$.contacts}/${e}`,{...a[e]}).then(n=>{n.code===0&&(Object.assign(c.value.filter(i=>e===i.id)[0],a[e]),r.success("编辑成功"))}).finally(()=>{y(e),t()})},y=e=>{delete a[e]},Y=e=>{if(x.value.includes(e))c.value=c.value.filter(t=>t.id!==e),r.success("删除成功");else{const t=r.loading("正在删除",0);I.delete(`${$.contacts}/${e}`).then(n=>{n.code===0&&(r.success("删除成功"),c.value=c.value.filter(i=>i.id!==e))}).finally(()=>{t()})}};return T({emits:g,visible:h,dataSource:c,columns:C,editingKey:"",editableData:a,paginationOptions:l,dateFormat:p,edit:w,save:U,cancel:y,deleteRecord:Y,handleAdd:L,handleTableChange:M,openModal:E,closeModal:F,submitAdd:B,submitEdit:N}),(e,t)=>{const n=X,i=Z,V=G,j=H,q=W,J=ee,K=te;return s(),k(K,{visible:h.value,title:"联系情况",width:1200,onCancel:t[0]||(t[0]=o=>g("cancel")),onOk:t[1]||(t[1]=o=>g("ok"))},{default:f(()=>[u.isReadOnly?P("",!0):(s(),k(n,{key:0,style:{"margin-bottom":"8px"},onClick:L},{default:f(()=>[S("新增")]),_:1})),D(J,{columns:C,loading:z.value,"data-source":c.value,pagination:l.value,onChange:M,scroll:{x:1500},bordered:"","row-key":"id"},{bodyCell:f(({column:o,text:Q,record:d})=>[["contact_date","contact_detail","demand","next_contact_date","remind_duration"].includes(o.dataIndex)?(s(),m("div",pe,[(o.dataIndex==="contact_date"||o.dataIndex==="next_contact_date")&&a[d.id]?(s(),k(i,{key:0,value:a[d.id][o.dataIndex],"onUpdate:value":_=>a[d.id][o.dataIndex]=_,"value-format":p},null,8,["value","onUpdate:value"])):o.dataIndex!=="contact_date"&&o.dataIndex!=="next_contact_date"&&a[d.id]?(s(),k(V,{key:1,value:a[d.id][o.dataIndex],"onUpdate:value":_=>a[d.id][o.dataIndex]=_,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(s(),m(le,{key:2},[S(ie(Q),1)],64))])):o.dataIndex==="operation"?(s(),m("div",re,[a[d.id]?(s(),m("span",ve,[D(j,{onClick:_=>U(d.id)},{default:f(()=>[S("保存")]),_:2},1032,["onClick"]),D(j,{onClick:_=>y(d.id)},{default:f(()=>[S("取消")]),_:2},1032,["onClick"])])):(s(),m("span",fe,[A("a",{onClick:_=>w(d.id)},"编辑",8,xe),D(q,{title:"确定删除该条记录吗?",onConfirm:_=>Y(d.id)},{default:f(()=>[me]),_:2},1032,["onConfirm"])]))])):P("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1},8,["visible"])}}},ze=ae(ge,[["__scopeId","data-v-778bcaa6"]]);const he=u=>(se("data-v-556d09fa"),u=u(),ce(),u),be={key:0},Ie={key:1,class:"editable-row-operations"},ye={key:0},Ce={key:1},$e=["onClick"],ke=he(()=>A("a",null,"删除",-1)),Se={__name:"ProductDetailTable",props:{isReadOnly:{type:Boolean,default:!1}},emits:["cancel","ok"],setup(u,{expose:T,emit:g}){const O=u,h=v(!1),b=v(""),E=e=>{b.value=e,h.value=!0,R()},F=()=>{b.value="",h.value=!1},I=[{title:"购买产品",dataIndex:"name"},{title:"购买金额",dataIndex:"amount"},{title:"收益率情况",dataIndex:"yield_rate"},{title:"购买时间",dataIndex:"buy_date"},{title:"产品天数",dataIndex:"day_number"},{title:"到期时间",dataIndex:"due_date"},{title:"操作",dataIndex:"operation",width:"160px"}];O.isReadOnly&&I.splice(I.length-1,1);const p=v([]),C=v(!1),c=oe("$http"),z="YYYY-MM-DD",a=de({}),x=v([]),l=v({current:1,pageSize:10,total:0,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共${e}条`}),M=e=>{l.value.current=e.current,l.value.pageSize=e.pageSize,l.value.total=e.total,R()},L=()=>{const e={id:ue(),customer_id:b.value,buy_date:"",name:"",amount:"",yield_rate:"",due_date:"",day_number:""};p.value.unshift(e),x.value.push(e.id),w(e.id),l.value.current=1},R=()=>{C.value=!0;const e={customerId:b.value,pageNo:l.value.current,pageSize:l.value.pageSize};c.get($.funds,{params:e}).then(t=>{const{data:n,total:i}=t;p.value=n,l.value.total=i}).finally(()=>{C.value=!1})},w=e=>{a[e]=ne(p.value.filter(t=>e===t.id)[0])},U=e=>{x.value.includes(e)?B(e):N(e)},B=e=>{const t=r.loading("正在提交",0);c.post($.funds,{...a[e]}).then(n=>{n.code===0&&(r.success("新增成功"),a[e].id=n.data.fund_id,x.value=x.value.filter(i=>i.id!==e))}).finally(()=>{Object.assign(p.value.filter(n=>e===n.id)[0],a[e]),y(e),t()})},N=e=>{const t=r.loading("正在提交",0);c.put(`${$.funds}/${e}`,{...a[e]}).then(n=>{n.code===0&&(Object.assign(p.value.filter(i=>e===i.id)[0],a[e]),r.success("编辑成功"))}).finally(()=>{y(e),t()})},y=e=>{delete a[e]},Y=e=>{if(x.value.includes(e))p.value=p.value.filter(t=>t.id!==e),r.success("删除成功");else{const t=r.loading("正在删除",0);c.delete(`${$.funds}/${e}`).then(n=>{n.code===0&&(r.success("删除成功"),p.value=p.value.filter(i=>i.id!==e))}).finally(()=>{t()})}};return T({emits:g,visible:h,dataSource:p,columns:I,dateFormat:z,editingKey:"",editableData:a,paginationOptions:l,edit:w,save:U,cancel:y,openModal:E,closeModal:F,deleteRecord:Y,handleAdd:L,handleTableChange:M}),(e,t)=>{const n=X,i=Z,V=G,j=H,q=W,J=ee,K=te;return s(),k(K,{visible:h.value,title:"基金理财/私募",width:1200,onCancel:t[0]||(t[0]=o=>g("cancel")),onOk:t[1]||(t[1]=o=>g("ok"))},{default:f(()=>[u.isReadOnly?P("",!0):(s(),k(n,{key:0,style:{"margin-bottom":"8px"},onClick:L},{default:f(()=>[S("新增")]),_:1})),D(J,{columns:I,loading:C.value,"data-source":p.value,pagination:l.value,onChange:M,bordered:""},{bodyCell:f(({column:o,text:Q,record:d})=>[["name","amount","yield_rate","buy_date","day_number","due_date"].includes(o.dataIndex)?(s(),m("div",be,[(o.dataIndex==="buy_date"||o.dataIndex==="due_date")&&a[d.id]?(s(),k(i,{key:0,value:a[d.id][o.dataIndex],"onUpdate:value":_=>a[d.id][o.dataIndex]=_,"value-format":z},null,8,["value","onUpdate:value"])):o.dataIndex!=="buy_date"&&o.dataIndex!=="due_date"&&a[d.id]?(s(),k(V,{key:1,value:a[d.id][o.dataIndex],"onUpdate:value":_=>a[d.id][o.dataIndex]=_,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(s(),m(le,{key:2},[S(ie(Q),1)],64))])):o.dataIndex==="operation"?(s(),m("div",Ie,[a[d.id]?(s(),m("span",ye,[D(j,{onClick:_=>U(d.id)},{default:f(()=>[S("保存")]),_:2},1032,["onClick"]),D(j,{onClick:_=>y(d.id)},{default:f(()=>[S("取消")]),_:2},1032,["onClick"])])):(s(),m("span",Ce,[A("a",{onClick:_=>w(d.id)},"编辑",8,$e),D(q,{title:"确定删除该条记录吗?",onConfirm:_=>Y(d.id)},{default:f(()=>[ke]),_:2},1032,["onConfirm"])]))])):P("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1},8,["visible"])}}},Me=ae(Se,[["__scopeId","data-v-556d09fa"]]);export{ze as C,Me as P,ue as u};
