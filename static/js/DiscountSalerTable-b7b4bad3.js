import{m as c,I as U,w as q,k as A,e as J}from"./ant-design-vue-a65eb274.js";import{u as K}from"./ProductDetailTable-46627c71.js";import{_ as M,a as I}from"./index-4cbe4d0c.js";import{c as Q}from"./lodash-es-26de6f87.js";import{e as G,l as b,r as H,aL as d,al as z,b8 as x,an as v,F as P,E as w,ac as W,c as D,ao as L,am as X,aN as Y,aM as Z}from"./@vue-e16f66a9.js";const ee=u=>(Y("data-v-72bf56ec"),u=u(),Z(),u),ae={key:0},te={key:1,class:"editable-row-operations"},ne={key:0},oe={key:1},se=["onClick"],ie=ee(()=>L("a",{style:{color:"#f0515f"}},"删除",-1)),le={__name:"DiscountSalerTable",props:{isReadOnly:{type:Boolean,default:!1},customerId:{type:[String,Number]}},setup(u,{expose:j}){const S=u,f=G("$http"),m=[{title:"券商名称",dataIndex:"name"},{title:"优势项目",dataIndex:"advantage_project"},{title:"操作",dataIndex:"operation",fixed:"right",width:"160px"}];S.isReadOnly&&m.splice(m.length-1,1);const i=b([]),C=b(!1),n=H({}),r=b([]),o=b({current:1,pageSize:10,total:0,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共${e}条`}),p=(e=null)=>{C.value=!0,e!==null&&(o.value.current=1);const a={customerId:S.customerId,pageNo:o.value.current,pageSize:o.value.pageSize};f.get(I.cooperations,{params:a}).then(t=>{const{data:s,total:$}=t;i.value=s,o.value.total=$}).finally(()=>{C.value=!1})},k=e=>{o.value.current=e.current,o.value.pageSize=e.pageSize,o.value.total=e.total,p()},B=()=>{const e={id:K(),customer_id:S.customerId,advantage_project:"",name:""};i.value.unshift(e),r.value.push(e.id),y(e.id),o.value.current=1},y=e=>{n[e]=Q(i.value.filter(a=>e===a.id)[0])},E=e=>{const a=["name","advantage_project"];let t=!0;return a.forEach(s=>{n[e][s]===""&&(t=!1)}),t},N=e=>{if(!E(e)){c.warning("请完整填写表格");return}r.value.includes(e)?R(e):V(e)},R=e=>{const a=c.loading("正在提交",0);f.post(I.cooperations,{...n[e]}).then(t=>{t.code===0&&(c.success("新增成功"),p(1),r.value=r.value.filter(s=>s.id!==e))}).finally(()=>{g(e),a()})},V=e=>{const a=c.loading("正在提交",0);f.put(`${I.cooperations}/${e}`,{...n[e]}).then(t=>{t.code===0&&(c.success("编辑成功"),p(1))}).finally(()=>{g(e),a()})},g=e=>{delete n[e]},T=e=>{if(r.value.includes(e))i.value=i.value.filter(a=>a.id!==e),c.success("删除成功");else{const a=c.loading("正在删除",0);f.delete(`${I.cooperations}/${e}`).then(t=>{t.code===0&&(c.success("删除成功"),i.value=i.value.filter(s=>s.id!==e),p(1))}).finally(()=>{a()})}};return j({dataSource:i,columns:m,editingKey:"",editableData:n,paginationOptions:o,edit:y,save:N,cancel:g,deleteRecord:T,handleAdd:B,handleTableChange:k,fetchTableData:p}),(e,a)=>{const t=U,s=q,$=A,F=J;return d(),z(F,{columns:m,"data-source":i.value,loading:C.value,pagination:o.value,onChange:k,bordered:""},{bodyCell:x(({column:h,text:O,record:l})=>[["name","advantage_project"].includes(h.dataIndex)?(d(),v("div",ae,[n[l.id]?(d(),z(t,{key:0,value:n[l.id][h.dataIndex],"onUpdate:value":_=>n[l.id][h.dataIndex]=_,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(d(),v(P,{key:1},[w(W(O),1)],64))])):h.dataIndex==="operation"?(d(),v("div",te,[n[l.id]?(d(),v("span",ne,[D(s,{onClick:_=>N(l.id)},{default:x(()=>[w("保存")]),_:2},1032,["onClick"]),D(s,{onClick:_=>g(l.id)},{default:x(()=>[w("取消")]),_:2},1032,["onClick"])])):(d(),v("span",oe,[L("a",{onClick:_=>y(l.id)},"编辑",8,se),D($,{title:"确定删除该条记录吗?",onConfirm:_=>T(l.id)},{default:x(()=>[ie]),_:2},1032,["onConfirm"])]))])):X("",!0)]),_:1},8,["data-source","loading","pagination"])}}},_e=M(le,[["__scopeId","data-v-72bf56ec"]]);export{_e as D};
