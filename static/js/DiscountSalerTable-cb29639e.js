import{m as d,B as X,I as Y,v as Z,o as G,g as H,M as P}from"./ant-design-vue-69c5e787.js";import{u as W}from"./ProductDetailTable-002d87ee.js";import{_ as ee,a as x}from"./index-a7c45ba7.js";import{c as ae}from"./lodash-es-c37e40cf.js";import{l as r,e as te,r as oe,X as c,Y as k,Z as _,E as S,a7 as N,c as $,a0 as f,F as ne,a6 as se,a1 as R,a2 as le,a3 as ie}from"./@vue-0057e33b.js";const ce=u=>(le("data-v-d8d6174c"),u=u(),ie(),u),de={key:0},ue={key:1,class:"editable-row-operations"},pe={key:0},re={key:1},_e=["onClick"],ve=ce(()=>R("a",null,"删除",-1)),me={__name:"DiscountSalerTable",props:{isReadOnly:{type:Boolean,default:!1}},emits:["cancel","ok"],setup(u,{expose:M,emit:y}){const V=u,g=r(!1),h=r(""),E=e=>{h.value=e,g.value=!0,B()},U=()=>{h.value="",g.value=!1},b=te("$http"),C=[{title:"券商名称",dataIndex:"name"},{title:"优势项目",dataIndex:"advantage_project"},{title:"操作",dataIndex:"operation"}];V.isReadOnly&&C.splice(C.length-1,1);const n=r([]),D=r(!1),t=oe({}),v=r([]),s=r({current:1,pageSize:10,total:0,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>`共${e}条`}),B=()=>{D.value=!0;const e={customerId:h.value,pageNo:s.value.current,pageSize:s.value.pageSize};b.get(x.cooperations,{params:e}).then(a=>{const{data:o,total:l}=a;n.value=o,s.value.total=l}).finally(()=>{D.value=!1})},O=e=>{s.value.current=e.current,s.value.pageSize=e.pageSize,s.value.total=e.total,B()},T=()=>{const e={id:W(),customer_id:h.value,advantage_project:"",name:""};n.value.unshift(e),v.value.push(e.id),w(e.id),s.value.current=1},w=e=>{t[e]=ae(n.value.filter(a=>e===a.id)[0])},j=e=>{v.value.includes(e)?A(e):F(e)},A=e=>{const a=d.loading("正在提交",0);b.post(x.cooperations,{...t[e]}).then(o=>{o.code===0&&(d.success("新增成功"),t[e].id=o.data.cooperation_id,v.value=v.value.filter(l=>l.id!==e))}).finally(()=>{Object.assign(n.value.filter(o=>e===o.id)[0],t[e]),I(e),a()})},F=e=>{const a=d.loading("正在提交",0);b.put(`${x.cooperations}/${e}`,{...t[e]}).then(o=>{o.code===0&&(Object.assign(n.value.filter(l=>e===l.id)[0],t[e]),d.success("编辑成功"))}).finally(()=>{I(e),a()})},I=e=>{delete t[e]},z=e=>{if(v.value.includes(e))n.value=n.value.filter(a=>a.id!==e),d.success("删除成功");else{const a=d.loading("正在删除",0);b.delete(`${x.cooperations}/${e}`).then(o=>{o.code===0&&(d.success("删除成功"),n.value=n.value.filter(l=>l.id!==e))}).finally(()=>{a()})}};return M({emits:y,dataSource:n,visible:g,columns:C,editingKey:"",editableData:t,paginationOptions:s,edit:w,save:j,cancel:I,openModal:E,closeModal:U,deleteRecord:z,handleAdd:T,handleTableChange:O}),(e,a)=>{const o=X,l=Y,L=Z,q=G,J=H,K=P;return c(),k(K,{visible:g.value,title:"已合作券商",width:1200,onCancel:a[0]||(a[0]=p=>y("cancel")),onOk:a[1]||(a[1]=p=>y("ok"))},{default:_(()=>[u.isReadOnly?N("",!0):(c(),k(o,{key:0,style:{"margin-bottom":"8px"},onClick:T},{default:_(()=>[S("新增")]),_:1})),$(J,{columns:C,"data-source":n.value,loading:D.value,pagination:s.value,onChange:O,bordered:""},{bodyCell:_(({column:p,text:Q,record:i})=>[["name","advantage_project"].includes(p.dataIndex)?(c(),f("div",de,[t[i.id]?(c(),k(l,{key:0,value:t[i.id][p.dataIndex],"onUpdate:value":m=>t[i.id][p.dataIndex]=m,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(c(),f(ne,{key:1},[S(se(Q),1)],64))])):p.dataIndex==="operation"?(c(),f("div",ue,[t[i.id]?(c(),f("span",pe,[$(L,{onClick:m=>j(i.id)},{default:_(()=>[S("保存")]),_:2},1032,["onClick"]),$(L,{onClick:m=>I(i.id)},{default:_(()=>[S("取消")]),_:2},1032,["onClick"])])):(c(),f("span",re,[R("a",{onClick:m=>w(i.id)},"编辑",8,_e),$(q,{title:"确定删除该条记录吗?",onConfirm:m=>z(i.id)},{default:_(()=>[ve]),_:2},1032,["onConfirm"])]))])):N("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},8,["visible"])}}},Ie=ee(me,[["__scopeId","data-v-d8d6174c"]]);export{Ie as D};
